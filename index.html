<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Player Pro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üéπ MIDI Player Pro</h1>
        
        <div class="tabs">
            <button class="tab active" data-tab="player">‚ñ∂ –ü–ª–µ–µ—Ä</button>
            <button class="tab" data-tab="export">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="tab" data-tab="import">üì• –°–æ–∑–¥–∞—Ç—å</button>
            <button class="tab" data-tab="record">üéôÔ∏è –ó–∞–ø–∏—Å—å</button>
        </div>

        <!-- TAB 1: –ü–õ–ï–ï–† -->
        <div class="tab-content active" id="player">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üéµ</div>
                <div class="upload-text">
                    –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ MIDI —Ñ–∞–π–ª —Å—é–¥–∞
                </div>
            </div>
            
            <input type="file" id="fileInput" accept=".mid,.midi">
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <div class="info-box" id="midiInfo"></div>
                <div class="tempo-info" id="tempoInfo" style="display: none;"></div>
            </div>

            <div class="visualizer" id="visualizer">
                <canvas id="canvas"></canvas>
                <div class="viz-debug" id="vizDebug">–ù–æ—Ç: 0</div>
            </div>

            <div class="visualization-mode" id="visualizationMode">
                <button class="viz-btn selected" data-mode="bars">üìä –°—Ç–æ–ª–±—Ü—ã</button>
                <button class="viz-btn" data-mode="wave">üåä –í–æ–ª–Ω–∞</button>
                <button class="viz-btn" data-mode="circle">‚≠ï –ö—Ä—É–≥</button>
            </div>

            <div class="instrument-selector" id="instrumentSelector">
                <label for="waveType">üéº –¢–∏–ø –∑–≤—É–∫–∞:</label>
                <select id="waveType">
                    <!-- –ë–∞–∑–æ–≤—ã–µ –≤–æ–ª–Ω—ã -->
                    <optgroup label="üîä –ë–∞–∑–æ–≤—ã–µ –≤–æ–ª–Ω—ã">
                        <option value="sine">–°–∏–Ω—É—Å–æ–∏–¥–∞ (–º—è–≥–∫–∏–π, —á–∏—Å—Ç—ã–π)</option>
                        <option value="square">–ö–≤–∞–¥—Ä–∞—Ç (—Ä–µ–∑–∫–∏–π, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π)</option>
                        <option value="sawtooth">–ü–∏–ª–∞ (—è—Ä–∫–∏–π, –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π)</option>
                        <option value="triangle" selected>–¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫ (—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)</option>
                    </optgroup>
                    
                    <!-- –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –∑–≤—É–∫–∏ -->
                    <optgroup label="üéπ –°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä—ã">
                        <option value="synth-pad">–°–∏–Ω—Ç-–ø–∞–¥ (–º—è–≥–∫–∏–π, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π)</option>
                        <option value="synth-lead">–°–∏–Ω—Ç-—Å–æ–ª–æ (—è—Ä–∫–∏–π, –≤–µ–¥—É—â–∏–π)</option>
                        <option value="synth-bass">–°–∏–Ω—Ç-–±–∞—Å (–≥–ª—É–±–æ–∫–∏–π, –±–∞—Å–æ–≤—ã–π)</option>
                        <option value="fm-bell">FM –∫–æ–ª–æ–∫–æ–ª—å—á–∏–∫ (–º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–π)</option>
                    </optgroup>
                    
                    <!-- –ò–º–∏—Ç–∞—Ü–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
                    <optgroup label="üé∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã">
                        <option value="piano">–ü–∏–∞–Ω–∏–Ω–æ (–º—è–≥–∫–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ)</option>
                        <option value="organ">–û—Ä–≥–∞–Ω (—É—Å—Ç–æ–π—á–∏–≤—ã–π)</option>
                        <option value="guitar">–ì–∏—Ç–∞—Ä–∞ (—â–∏–ø–∫–æ–≤—ã–π)</option>
                        <option value="strings">–°—Ç—Ä—É–Ω–Ω—ã–µ (–æ—Ä–∫–µ—Å—Ç—Ä–æ–≤—ã–µ)</option>
                        <option value="brass">–î—É—Ö–æ–≤—ã–µ (–º–µ–¥–Ω—ã–µ)</option>
                        <option value="flute">–§–ª–µ–π—Ç–∞ (–≤–æ–∑–¥—É—à–Ω–∞—è)</option>
                    </optgroup>
                    
                    <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã –∏ —Å–ø–µ—Ü–∑–≤—É–∫–∏ -->
                    <optgroup label="‚ú® –°–ø–µ—Ü—ç—Ñ—Ñ–µ–∫—Ç—ã">
                        <option value="distortion">–î–∏—Å—Ç–æ—Ä—à–Ω (–∏—Å–∫–∞–∂–µ–Ω–Ω—ã–π)</option>
                        <option value="noise">–®—É–º (–ø–µ—Ä–∫—É—Å—Å–∏—è)</option>
                        <option value="choir">–•–æ—Ä (–≤–æ–∫–∞–ª—å–Ω—ã–π)</option>
                        <option value="vintage">–í–∏–Ω—Ç–∞–∂–Ω—ã–π (—Ä–µ—Ç—Ä–æ)</option>
                    </optgroup>
                </select>
            </div>

            <div class="slider-control" id="volumeControl">
                <span class="slider-label">üîä –ì—Ä–æ–º–∫–æ—Å—Ç—å:</span>
                <input type="range" id="volumeSlider" min="0" max="100" value="30">
                <span class="slider-value" id="volumeValue">30%</span>
            </div>

            <div class="slider-control" id="tempoControl">
                <span class="slider-label">‚è±Ô∏è –¢–µ–º–ø:</span>
                <input type="range" id="tempoSlider" min="25" max="300" value="100" step="5">
                <span class="slider-value" id="tempoValue">100%</span>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>
            
            <div class="controls">
                <button id="playBtn" disabled>
                    <span>‚ñ∂</span> –ò–≥—Ä–∞—Ç—å
                </button>
                <button id="pauseBtn" disabled>
                    <span>‚è∏</span> –ü–∞—É–∑–∞
                </button>
                <button id="stopBtn" disabled>
                    <span>‚èπ</span> –°—Ç–æ–ø
                </button>
            </div>
            
            <div class="status" id="status">–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞</div>
        </div>

        <!-- TAB 2: –≠–ö–°–ü–û–†–¢ -->
        <div class="tab-content" id="export">
            <div class="help-text">
                <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç MIDI –≤ JSON/WAV</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –≤ –ø–ª–µ–µ—Ä–µ, –∑–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞.</p>
            </div>

            <div class="controls">
                <button id="exportJsonBtn" disabled>
                    <span>üì•</span> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ JSON
                </button>
                <button id="exportWavBtn" class="secondary" disabled>
                    <span>üéµ</span> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WAV
                </button>
            </div>

            <div class="json-editor">
                <label>JSON –¥–∞–Ω–Ω—ã–µ:</label>
                <textarea id="jsonOutput" placeholder="JSON –¥–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞..." readonly></textarea>
            </div>

            <div class="controls">
                <button id="downloadJsonBtn" class="secondary" disabled>
                    <span>üíæ</span> –°–∫–∞—á–∞—Ç—å JSON
                </button>
            </div>
        </div>

        <!-- TAB 3: –°–û–ó–î–ê–¢–¨ MIDI -->
        <div class="tab-content" id="import">
            <div class="help-text">
                <h3>üì• –°–æ–∑–¥–∞–Ω–∏–µ MIDI –∏–∑ JSON</h3>
                <p>–§–æ—Ä–º–∞—Ç JSON:</p>
                <code>{"tracks": [{"notes": [{"note": 60, "time": 0, "duration": 0.5, "velocity": 100}]}]}</code>
                <p style="margin-top: 10px;"><strong>note:</strong> MIDI –Ω–æ—Ç–∞ (60 = C4), <strong>time:</strong> –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö, <strong>duration:</strong> –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, <strong>velocity:</strong> –≥—Ä–æ–º–∫–æ—Å—Ç—å (0-127)</p>
            </div>

            <div class="upload-area-small" id="jsonUploadArea">
                <div class="upload-icon">üìÑ</div>
                <div class="upload-text">
                    –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞
                </div>
            </div>
            
            <input type="file" id="jsonFileInput" accept=".json">

            <div class="json-editor">
                <label>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ JSON –≤—Ä—É—á–Ω—É—é:</label>
                <textarea id="jsonInput" placeholder='{"tracks": [{"notes": [{"note": 60, "time": 0, "duration": 0.5, "velocity": 100}]}]}'></textarea>
            </div>

            <div class="controls">
                <button id="createMidiBtn">
                    <span>üéµ</span> –°–æ–∑–¥–∞—Ç—å MIDI —Ñ–∞–π–ª
                </button>
                <button id="previewMidiBtn" class="secondary">
                    <span>‚ñ∂</span> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                </button>
            </div>

            <div class="status" id="importStatus"></div>
        </div>

        <!-- TAB 4: –ó–ê–ü–ò–°–¨ -->
        <div class="tab-content" id="record">
            <div class="help-text">
                <h3>üéôÔ∏è –ó–∞–ø–∏—Å—å –≤ –∞—É–¥–∏–æ —Ñ–∞–π–ª</h3>
                <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –≤ –ø–ª–µ–µ—Ä–µ, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å" –∏ "–ò–≥—Ä–∞—Ç—å". –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å" –∏ —Å–∫–∞—á–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p>
            </div>

            <div class="recording-indicator" id="recordingIndicator">
                ‚ö´ –ò–¥–µ—Ç –∑–∞–ø–∏—Å—å...
            </div>

            <div class="controls">
                <button id="startRecordBtn" disabled>
                    <span>‚ö´</span> –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
                </button>
                <button id="stopRecordBtn" disabled>
                    <span>‚èπ</span> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
                </button>
            </div>

            <div class="controls">
                <button id="downloadAudioBtn" class="secondary" disabled>
                    <span>üíæ</span> –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ (WAV)
                </button>
            </div>

            <div class="status" id="recordStatus">–ó–∞–≥—Ä—É–∑–∏—Ç–µ MIDI —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏</div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>